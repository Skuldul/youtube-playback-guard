#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

if ! command -v npm >/dev/null 2>&1; then
  echo "Error: npm is not installed."
  echo
  exit 1
fi

if [[ ! -x "$REPO_ROOT/node_modules/.bin/web-ext" ]]; then
  echo "Error: dependencies not installed. Run 'npm install' first."
  echo
  exit 1
fi

npm run build:chrome

npx web-ext build \
  --source-dir "$REPO_ROOT/dist/chrome" \
  --artifacts-dir "$REPO_ROOT/web-ext-artifacts/chrome" \
  --overwrite-dest \
  "$@"
